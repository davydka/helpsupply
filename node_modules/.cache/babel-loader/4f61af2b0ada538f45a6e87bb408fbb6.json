{"ast":null,"code":"function updateSearch(hospital_index, term) {\n  let results = [];\n  let city_hits = hospital_index.city_index[term] || [];\n\n  for (var i = 0; i < city_hits.length; i++) {\n    let h = hospital_index.id_index[city_hits[i]];\n    let id = city_hits[i];\n    results.push({\n      hospital: h,\n      id: id\n    });\n  }\n\n  let words = term.split(\" \");\n  let hits = [];\n\n  for (var i = 0; i < words.length; i++) {\n    let new_hits = hospital_index.term_index[words[i]] || [];\n\n    if (new_hits.length > 0) {\n      if (i == 0) {\n        hits = new_hits;\n      } else {\n        hits = hits.filter(x => new_hits.includes(x));\n      }\n    }\n  }\n\n  for (var i = 0; i < hits.length; i++) {\n    let h = hospital_index.id_index[hits[i]];\n    let id = hits[i];\n    results.push({\n      hospital: h,\n      id: id\n    });\n  } // filter out for uniques\n\n\n  var uniqueResults = [];\n  results.forEach(function (result) {\n    var i = uniqueResults.findIndex(x => x.id == result.id);\n\n    if (i <= -1) {\n      uniqueResults.push({\n        hospital: result.hospital,\n        id: result.id\n      });\n    }\n  });\n  return uniqueResults;\n}\n\nexport { updateSearch };","map":{"version":3,"sources":["/Users/johnson/Dropbox/Coronavirus/hc-v2/hospitalcommunity/src/functions.js"],"names":["updateSearch","hospital_index","term","results","city_hits","city_index","i","length","h","id_index","id","push","hospital","words","split","hits","new_hits","term_index","filter","x","includes","uniqueResults","forEach","result","findIndex"],"mappings":"AAAA,SAASA,YAAT,CAAsBC,cAAtB,EAAsCC,IAAtC,EAA4C;AAC1C,MAAIC,OAAO,GAAG,EAAd;AACA,MAAIC,SAAS,GAAGH,cAAc,CAACI,UAAf,CAA0BH,IAA1B,KAAmC,EAAnD;;AAEA,OAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,SAAS,CAACG,MAA9B,EAAsCD,CAAC,EAAvC,EAA2C;AACzC,QAAIE,CAAC,GAAGP,cAAc,CAACQ,QAAf,CAAwBL,SAAS,CAACE,CAAD,CAAjC,CAAR;AACA,QAAII,EAAE,GAAGN,SAAS,CAACE,CAAD,CAAlB;AACAH,IAAAA,OAAO,CAACQ,IAAR,CAAa;AAAEC,MAAAA,QAAQ,EAAEJ,CAAZ;AAAeE,MAAAA,EAAE,EAAEA;AAAnB,KAAb;AACD;;AAED,MAAIG,KAAK,GAAGX,IAAI,CAACY,KAAL,CAAW,GAAX,CAAZ;AACA,MAAIC,IAAI,GAAG,EAAX;;AACA,OAAK,IAAIT,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGO,KAAK,CAACN,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACrC,QAAIU,QAAQ,GAAGf,cAAc,CAACgB,UAAf,CAA0BJ,KAAK,CAACP,CAAD,CAA/B,KAAuC,EAAtD;;AACA,QAAIU,QAAQ,CAACT,MAAT,GAAkB,CAAtB,EAAyB;AACvB,UAAID,CAAC,IAAI,CAAT,EAAY;AACVS,QAAAA,IAAI,GAAGC,QAAP;AACD,OAFD,MAEO;AACLD,QAAAA,IAAI,GAAGA,IAAI,CAACG,MAAL,CAAYC,CAAC,IAAIH,QAAQ,CAACI,QAAT,CAAkBD,CAAlB,CAAjB,CAAP;AACD;AACF;AACF;;AAED,OAAK,IAAIb,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGS,IAAI,CAACR,MAAzB,EAAiCD,CAAC,EAAlC,EAAsC;AACpC,QAAIE,CAAC,GAAGP,cAAc,CAACQ,QAAf,CAAwBM,IAAI,CAACT,CAAD,CAA5B,CAAR;AACA,QAAII,EAAE,GAAGK,IAAI,CAACT,CAAD,CAAb;AACAH,IAAAA,OAAO,CAACQ,IAAR,CAAa;AAAEC,MAAAA,QAAQ,EAAEJ,CAAZ;AAAeE,MAAAA,EAAE,EAAEA;AAAnB,KAAb;AACD,GA3ByC,CA6B1C;;;AACA,MAAIW,aAAa,GAAG,EAApB;AACAlB,EAAAA,OAAO,CAACmB,OAAR,CAAgB,UAASC,MAAT,EAAiB;AAC/B,QAAIjB,CAAC,GAAGe,aAAa,CAACG,SAAd,CAAwBL,CAAC,IAAIA,CAAC,CAACT,EAAF,IAAQa,MAAM,CAACb,EAA5C,CAAR;;AACA,QAAIJ,CAAC,IAAI,CAAC,CAAV,EAAa;AACXe,MAAAA,aAAa,CAACV,IAAd,CAAmB;AAAEC,QAAAA,QAAQ,EAAEW,MAAM,CAACX,QAAnB;AAA6BF,QAAAA,EAAE,EAAEa,MAAM,CAACb;AAAxC,OAAnB;AACD;AACF,GALD;AAOA,SAAOW,aAAP;AACD;;AAED,SAASrB,YAAT","sourcesContent":["function updateSearch(hospital_index, term) {\n  let results = [];\n  let city_hits = hospital_index.city_index[term] || [];\n\n  for (var i = 0; i < city_hits.length; i++) {\n    let h = hospital_index.id_index[city_hits[i]];\n    let id = city_hits[i];\n    results.push({ hospital: h, id: id });\n  }\n\n  let words = term.split(\" \");\n  let hits = [];\n  for (var i = 0; i < words.length; i++) {\n    let new_hits = hospital_index.term_index[words[i]] || [];\n    if (new_hits.length > 0) {\n      if (i == 0) {\n        hits = new_hits;\n      } else {\n        hits = hits.filter(x => new_hits.includes(x));\n      }\n    }\n  }\n\n  for (var i = 0; i < hits.length; i++) {\n    let h = hospital_index.id_index[hits[i]];\n    let id = hits[i];\n    results.push({ hospital: h, id: id });\n  }\n\n  // filter out for uniques\n  var uniqueResults = [];\n  results.forEach(function(result) {\n    var i = uniqueResults.findIndex(x => x.id == result.id);\n    if (i <= -1) {\n      uniqueResults.push({ hospital: result.hospital, id: result.id });\n    }\n  });\n\n  return uniqueResults;\n}\n\nexport { updateSearch };\n"]},"metadata":{},"sourceType":"module"}